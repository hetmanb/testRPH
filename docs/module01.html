<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Module 1 – R for Public Health</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-9859ad12c646e21909f796ca9dd1bd29.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="temp_styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">R for Public Health</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html#intro"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./module01.html" aria-current="page"> 
<span class="menu-text">Module 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./module02.html"> 
<span class="menu-text">Module 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./module03.html"> 
<span class="menu-text">Module 3</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#module-1-learning-objectives" id="toc-module-1-learning-objectives" class="nav-link active" data-scroll-target="#module-1-learning-objectives">Module 1 Learning objectives</a>
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives">Learning objectives</a></li>
  </ul></li>
  <li><a href="#loading-our-first-dataset" id="toc-loading-our-first-dataset" class="nav-link" data-scroll-target="#loading-our-first-dataset">Loading our first dataset</a></li>
  <li><a href="#tidy-data-and-r" id="toc-tidy-data-and-r" class="nav-link" data-scroll-target="#tidy-data-and-r">Tidy data and R</a></li>
  <li><a href="#identifying-data-cleaning-needs" id="toc-identifying-data-cleaning-needs" class="nav-link" data-scroll-target="#identifying-data-cleaning-needs">Identifying data cleaning needs</a></li>
  <li><a href="#data-cleaning-steps" id="toc-data-cleaning-steps" class="nav-link" data-scroll-target="#data-cleaning-steps">Data cleaning steps</a>
  <ul>
  <li><a href="#step-1-rename-variables" id="toc-step-1-rename-variables" class="nav-link" data-scroll-target="#step-1-rename-variables">Step 1: Rename variables</a></li>
  <li><a href="#step-2-fix-date-of-birth" id="toc-step-2-fix-date-of-birth" class="nav-link" data-scroll-target="#step-2-fix-date-of-birth">Step 2: Fix date of birth</a></li>
  <li><a href="#step-3-re-create-an-age-variable-from-dob" id="toc-step-3-re-create-an-age-variable-from-dob" class="nav-link" data-scroll-target="#step-3-re-create-an-age-variable-from-dob">Step 3: (Re-)Create an age variable from DOB</a></li>
  <li><a href="#step-4-fix-province-variable" id="toc-step-4-fix-province-variable" class="nav-link" data-scroll-target="#step-4-fix-province-variable">Step 4: Fix Province variable</a>
  <ul class="collapse">
  <li><a href="#the-case_when-function" id="toc-the-case_when-function" class="nav-link" data-scroll-target="#the-case_when-function">The case_when function</a></li>
  </ul></li>
  <li><a href="#step-5-emergency-contact-information" id="toc-step-5-emergency-contact-information" class="nav-link" data-scroll-target="#step-5-emergency-contact-information">Step 5: Emergency Contact Information</a>
  <ul class="collapse">
  <li><a href="#the-stringr-package" id="toc-the-stringr-package" class="nav-link" data-scroll-target="#the-stringr-package">The stringr package</a></li>
  </ul></li>
  <li><a href="#step-6-fix-boarding-date." id="toc-step-6-fix-boarding-date." class="nav-link" data-scroll-target="#step-6-fix-boarding-date.">Step 6: Fix boarding date.</a></li>
  <li><a href="#saving-your-dataset-to-disk" id="toc-saving-your-dataset-to-disk" class="nav-link" data-scroll-target="#saving-your-dataset-to-disk">Saving your dataset to disk</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#quiz" id="toc-quiz" class="nav-link" data-scroll-target="#quiz">Quiz</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="module01.docx"><i class="bi bi-file-word"></i>MS Word</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Module 1</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="module-1-learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="module-1-learning-objectives">Module 1 Learning objectives</h2>
<p>Ahoy!</p>
<p>Welcome to the first module of ArrrrrrPH! These modules are designed to provide foundational and experiential learning components of the TDU’s R for Public Health course. By working through the module, and following along with the reasoning provided, we hope that you’ll come away not only with a bit of coding muscle-memory, but also a stronger grasp of the reasoning behind why we make certain choices when it comes to working with data and coding.</p>
<p>Everything that you need to complete the case study for the course should be included in these modules, but they do assume a beginner-to-intermediate working competency in R. If you have any issues getting the code to work - do not hesitate to reach out to one of your course facilitators for help.</p>
<section id="learning-objectives" class="level3">
<h3 class="anchored" data-anchor-id="learning-objectives">Learning objectives</h3>
<p>By the end of Module 1, you will be able to</p>
<ol type="1">
<li>Build tidyverse workflows using the <strong>%&gt;%</strong> operator</li>
<li>Discuss best-practices for tidy (clean) datasets</li>
<li>Apply tidyverse functions to a complex dataset</li>
</ol>
<p>Now that you’ve dipped your toes into the seas of R coding, the ship’s steward has sent you the passenger manifest to work on next. As a savvy epidemiologist, however, you know that you’ll need to review and clean the data before setting sail on any analyses.</p>
<p>For this module, you’ll be required to identify parts of the manifest that need correction before using it for any coding analyses, and fix these issues using tools available to us as part of the Tidyverse collection of data-manipulation packages.</p>
</section>
</section>
<section id="loading-our-first-dataset" class="level2">
<h2 class="anchored" data-anchor-id="loading-our-first-dataset">Loading our first dataset</h2>
<p>Let’s try loading our first dataset.</p>
<p>For this, we’ll be using a <em>function</em> from the <em>Tidyverse</em> package. In order to do this, we’ll need to make sure that we’ve first loaded the <em>Tidyverse</em> into our working session.</p>
<p>Type the following into your R script.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(tidyverse)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Great - now we have all of the different functions from Tidyverse available to use! For this course, we’ll only be using a very small number of the total available functions, but if you want to check out all that the Tidyverse has to offer, you can review the <a href="https://tidyverse.org/packages" title="Tidyverse Packages">included packages here</a>.</p>
<p>Let’s take a look inside the folders for <strong>Module 1</strong> - there should be three:</p>
<ol type="1">
<li>data/</li>
<li>scripts/</li>
<li>output/</li>
</ol>
<p>Inside the data/ folder you’ll find the dataset for module 1, which is saved as an excel workbook. We’ll want to convert this to an easier format to deal with later, but first let’s try loading the file into R and having a quick look at what we’re working with here!</p>
<p>In order to read the excel file directly into your computers memory without any format changes, we’ll use the <strong>readxl</strong> package, which, lucky for us, works great with tidyverse. However, the package is <strong>not</strong> included in tidyverse, so we’ll need to install and load it into memory separately.</p>
<p>Try installing and loading <strong>readxl</strong>, then using the function <em>read_excel()</em> to load the file “ship_manifest.xlsx”</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"participant_data/module1/ship_manifest.xlsx"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 604 × 16</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    Definitely not pirate…¹ ...2  ...3  ...4  ...5  ...6  ...7  ...8  ...9  ...10</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Ship:                   "S. … &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Captain:                "Cpt… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Chief Steward:          "Peg… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Ship Capacity:          "814" &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Cruise Dates:           "10t… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Cruise Route:           "Hal… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 &lt;NA&gt;                     &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 &lt;NA&gt;                     &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Passenger Information    &lt;NA&gt; &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  Pass… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 First                   "Las… DOB   Age   Gend… Memb… Addr… City  Prov… Coun…</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ 594 more rows</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ abbreviated name: ¹​`Definitely not pirates cruise ship company ™`</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ 6 more variables: ...11 &lt;chr&gt;, ...12 &lt;chr&gt;, ...13 &lt;chr&gt;, ...14 &lt;chr&gt;,</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="do">## #   ...15 &lt;chr&gt;, ...16 &lt;chr&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Okay, something appears to not be working as expected here. Let’s open the file in Excel and see what’s going on…</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<div id="pic_passmanifest" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pics/passengermanifesttop.jpg" class="img-fluid figure-img" alt="An image of a data table showing a large header section"></p>
<figcaption>The header section of the passenger manifest</figcaption>
</figure>
</div>
</div>
</div>
<p>Yikes!</p>
<p>When will these fictional-nautical-based-tourism-that-definitely-aren’t-pirates-companies ever learn to make their data collection forms friendly with machine-readable tools?</p>
<p>Okay but all kidding aside - get used to it! Navigating strange formatting issues is a highly-useful skill that will come in handy many times in your public health career!</p>
</section>
<section id="tidy-data-and-r" class="level2">
<h2 class="anchored" data-anchor-id="tidy-data-and-r">Tidy data and R</h2>
<p>When we interpret tables in R, the software is expecting consistent columns, each containing a unique variable, with the top row of all the columns containing a name for each variable. If we look a little more closely, we can actually see that this is the case for the useful data in the form, however, we first need to tell R to remove, or skip, the rows of the form that do not contain useful information.</p>
<p>Fortunately, this is pretty easy to do with our <strong>read_excel()</strong> function. Review the function help using the following line of code.</p>
<blockquote class="blockquote">
<p>help(read_excel)</p>
</blockquote>
<p>This should pop up the help file in the bottom right pane in RStudio, where you’ll see the following under the function usage:</p>
<blockquote class="blockquote">
<p>read_excel(<br>
path,<br>
sheet = NULL,<br>
range = NULL,<br>
col_names = TRUE,<br>
col_types = NULL,<br>
na = ““,<br>
trim_ws = TRUE,<br>
skip = 0,<br>
n_max = Inf,<br>
guess_max = min(1000, n_max),<br>
progress = readxl_progress(),<br>
.name_repair =”unique”<br>
)</p>
</blockquote>
<p>The argument that we’re interested in is <strong>skip = 0</strong>. If we include this argument in our <strong>read_excel()</strong> function, then R will automatically skip the number of rows indicated. Let’s try running the code again, but this time, skipping over the first 10 rows of the worksheet.</p>
<p>We’ll also save the file to an object called ‘manifest’ so we can easily modify and use it later on.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>manifest <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"participant_data/module1/ship_manifest.xlsx"</span>, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">skip =</span> <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="identifying-data-cleaning-needs" class="level2">
<h2 class="anchored" data-anchor-id="identifying-data-cleaning-needs">Identifying data cleaning needs</h2>
<p>Let’s take a moment now to review the <strong>manifest</strong> object and learn a little about it. There are several functions that can help you become familiar with data objects. Because we’re mainly focused here on using as many <strong>Tidyverse</strong> functions as possible, let’s check out the function <em>glimpse()</em>. This function operates very similarly to the base R <strong>structure</strong> function <em>str()</em>, however, provides the output in a more neatly organized way. Try it out on the <strong>manifest</strong> object you imported earlier.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(manifest)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 594</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Columns: 16</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="do">## $ First...1           &lt;chr&gt; "Nicole", "Nicole", "Scott", "Julie", "Kaitlyn", "…</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="do">## $ Last...2            &lt;chr&gt; "Miller", "Ramirez", "Ramirez", "Spencer", "Jones"…</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="do">## $ DOB                 &lt;chr&gt; "21445", "27047", "28507", "36314", "35219", "2358…</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="do">## $ Age                 &lt;dbl&gt; 67, 51, 47, 26, 29, 61, 62, 27, 28, 30, 54, 27, 39…</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="do">## $ Gender              &lt;chr&gt; "Female", "Female", "Male", "Female", "Female", "M…</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="do">## $ `Member Status`     &lt;chr&gt; "Silver", "Platinum", "Platinum", "Silver", "Silve…</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="do">## $ Address             &lt;chr&gt; "8125 Tony Stravenue Boulevard, Lethbridge, Albert…</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="do">## $ City                &lt;chr&gt; "Lethbridge", "Red Deer", "Red Deer", "Red Deer", …</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="do">## $ Province            &lt;chr&gt; "AB", "AB", "AB", "AB", "AB", "British Columbia", …</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="do">## $ Country             &lt;chr&gt; "Canada", "Canada", "Canada", "Canada", "Canada", …</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="do">## $ First...11          &lt;chr&gt; "Lisa", "Jeffrey", "Jeffrey", "Bradley", "Bradley"…</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="do">## $ Last...12           &lt;chr&gt; "Jackson", "Meyer", "Meyer", "Robertson", "Roberts…</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="do">## $ Relationship        &lt;chr&gt; "Relative", "Relative", "Relative", "Other", "Othe…</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="do">## $ `Phone number`      &lt;chr&gt; "(483) 503-0564", "(356) 159-5148", "(356) 159-514…</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="do">## $ `Boarding Date`     &lt;chr&gt; "Feb 9th", "Feb 9th", "Feb 9th", "Feb 9th", "Feb 9…</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="do">## $ `Boarding Location` &lt;chr&gt; "Halifax, NS", "Halifax, NS", "Halifax, NS", "Hali…</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Take a few minutes to further explore the data however you see fit, and jot down any characteristics about the dataset that you think might pose a problem later on. When you’re done that, review the code provided below and note how your data-cleaning process compared to ours.</p>
<p><strong>A few tips to keep in mind when looking for potential data issues:</strong></p>
<ol type="1">
<li><p>Are variables named consistently and without spaces or special characters?</p></li>
<li><p>Are the data contained within each variable consistent? I.e., only one data type per variable?</p></li>
<li><p>Are there missing values within any of your variables? What about sentinel values like those in the following table? How will you plan to treat these?</p>
<table class="caption-top table">
<caption>Table of sentinel values</caption>
<colgroup>
<col style="width: 34%">
<col style="width: 65%">
</colgroup>
<thead>
<tr class="header">
<th>Value or symbol</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>.</td>
<td>Period. Often used to denote purposely missing values in programs like Stata.</td>
</tr>
<tr class="even">
<td>-</td>
<td>Dash. Can denote missing value, negative, empty cell, or errors.</td>
</tr>
<tr class="odd">
<td>999</td>
<td>Three nines (999). This code is often used to represent ‘missing’ or ‘unknown’.</td>
</tr>
<tr class="even">
<td>N/A</td>
<td>Not applicable. This is sometimes written purposively, and other times is an automatic replacement for blank cells.</td>
</tr>
<tr class="odd">
<td><em>Missing</em></td>
<td>The word ‘missing.’ This is often input manually by someone who wants signify that the data were not collected, and that an empty cell is not the result of a data entry error.</td>
</tr>
<tr class="even">
<td>(blank)</td>
<td>Blank cell. Impossible to know whether a cell was left intentionally blank, or whether it is the result of data entry errors.</td>
</tr>
</tbody>
</table></li>
<li><p>How are dates formatted?</p></li>
<li><p>How do you want place names to be formatted? E.g., should provinces be spelled out in full, or is it easier to replace these with abbreviated versions?</p></li>
<li><p>Are there extraneous variables in the data? If yes, what do you propose doing with these?</p></li>
</ol>
<hr>
<p>When you’re ready - let’s move on and see how your findings compared to ours! Below is a list of issues that we found with the passenger manifest table.</p>
<details>
<summary>
<strong>Click to show the list</strong>
</summary>
<ul>
<li><p>Once the header information was removed to make the file human-readable, we lost the information about whether variables were capturing <strong>passenger information</strong>, or <strong>emergency contact information</strong>. As a result, we now have duplicated variable names! This will not do! We’ll need to remove or change the variables names to ensure that each one is unique and informative. While we’re at it - we should make sure that none of our variables contain special characters or spaces in them too.</p></li>
<li><p>In the <strong>DOB</strong> variable, there appears to be multiple different formats. We’ll need to fix this as this is a very important variable if we want to know the passenger’s age.</p></li>
<li><p>Speaking of age.. it looks like someone was trying to use an Excel formula to calculate it - but pretty quickly ran into a snag due to some incorrect formatting in the DOB column, resulting in a lot of “#N/A” inputs. We’ll want to replace the current <strong>Age</strong> variable with a corrected version.</p></li>
<li><p><strong>Province</strong> of residence appears to have quite a number of different formats going on, between fully-spelled-out versions of province names and abbreviated versions. We’ll need to capture the unique set of these, and ensure that we take a consistent approach.</p></li>
<li><p>Emergency contact information appears to have undergone some input issues as well. Even though the variables are supposed to include <strong>first</strong> and <strong>last</strong> names, it appears that titles and professional designations somehow made it in, and is causing some issues. Also - there are quite a few missing entries, so we’ll need to make some decisions on what to do with these data.</p></li>
<li><p><strong>Boarding Date</strong> for some reason has the date written out in a non-date format. We should probably fix this as well.</p></li>
</ul>
</details>
</section>
<section id="data-cleaning-steps" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning-steps">Data cleaning steps</h2>
<p>Now that we have our list, let’s get started on cleaning the dataset so that it can be useful for future cross-referencing whenever we need to look up something about our passengers.</p>
<section id="step-1-rename-variables" class="level3">
<h3 class="anchored" data-anchor-id="step-1-rename-variables">Step 1: Rename variables</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># First, let's get a list of all the variables currently included in the manifest dataset</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">names</span>(manifest)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(vars)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] "First...1"         "Last...2"          "DOB"              </span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  [4] "Age"               "Gender"            "Member Status"    </span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7] "Address"           "City"              "Province"         </span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [10] "Country"           "First...11"        "Last...12"        </span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [13] "Relationship"      "Phone number"      "Boarding Date"    </span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [16] "Boarding Location"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>There appears to be two problems happening here:</p>
<ol type="1">
<li>First…1 and Last…2 versus First…11 and Last…12 - we’ll need to fix these so that they make more sense and are easier to work with.</li>
<li>Several variables include spaces in their naming, so we’ll fix that too.</li>
</ol>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a new variable that includes the corrected names of variables for the passenger manifest:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>fixed_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"pass.fname"</span>, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">"pass.lname"</span>, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">"pass.dob"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"pass.age"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"pass.gender"</span>, </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"pass.status"</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"home.address"</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"home.city"</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"home.prov"</span>, </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">"home.country"</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">"emerg.contact.fname"</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">"emerg.contact.lname"</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">"emerg.contact.relationship"</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">"emerg.contact.phone"</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">"board.date"</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">"board.location"</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the variable names in the dataset with the corrected versions: </span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(manifest) <span class="ot">&lt;-</span> fixed_vars</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the names and double check that it worked! </span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(manifest)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] "pass.fname"                 "pass.lname"                </span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="do">##  [3] "pass.dob"                   "pass.age"                  </span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="do">##  [5] "pass.gender"                "pass.status"               </span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="do">##  [7] "home.address"               "home.city"                 </span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="do">##  [9] "home.prov"                  "home.country"              </span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="do">## [11] "emerg.contact.fname"        "emerg.contact.lname"       </span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="do">## [13] "emerg.contact.relationship" "emerg.contact.phone"       </span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="do">## [15] "board.date"                 "board.location"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Excellent, we can cross the first item off of our list: fixing variable names. Next, let’s look at the date of birth variable.</p>
</section>
<section id="step-2-fix-date-of-birth" class="level3">
<h3 class="anchored" data-anchor-id="step-2-fix-date-of-birth">Step 2: Fix date of birth</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's have a look at the data in the dob variable: </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(manifest <span class="sc">%&gt;%</span> <span class="fu">select</span>(pass.dob))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 594</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Columns: 1</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="do">## $ pass.dob &lt;chr&gt; "21445", "27047", "28507", "36314", "35219", "23589", "23224"…</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Wait a second.. oh no. Excel again..</p>
<p>So it turns out, that by reading these data in directly from Excel, we have retained some Excel-scurvy! Dates in excel are formatted in a very unique way: it simply counts the number of days passed starting with “1” on January 1, 1900.</p>
<p>We’ll need to use a few extra tricks it seems to fix this issue. But first, lets strategize a couple different ways to do this.</p>
<ol type="1">
<li>The easiest, is probably to reopen the file in Excel - fix the few dates that aren’t formatted the same as the majority, and then re-write all the dates in a non-date format in Excel. This is an R course, though, so we’re not going to do that!</li>
<li>As alluded to in the above suggestion, we should first focus on making all the data in the variable consistent, then do some operation on all them at once. We can do this easily enough in R, and using a scripting language helps us keep track of everything we did, compared to Excel where we can get distracted and forget to record our steps. Win win.</li>
</ol>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's start by printing the entire DOB variable and checking which entries need fixing: </span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>birthdates <span class="ot">&lt;-</span> manifest<span class="sc">$</span>pass.dob</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(birthdates)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   [1] "21445"          "27047"          "28507"          "36314"         </span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   [5] "35219"          "23589"          "23224"          "35962"         </span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   [9] "35506"          "34776"          "26125"          "36119"         </span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  [13] "31647"          "August 21 1992" "17882"          "21782"         </span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  [17] "21052"          "34099"          "35194"          "23545"         </span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  [21] "22815"          "17244"          "36900"          "30627"         </span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  [25] "30262"          "18054"          "20244"          "33628"         </span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  [29] "33994"          "29601"          "31791"          "33258"         </span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  [33] "33623"          "28136"          "17175"          "30936"         </span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  [37] "32396"          "31966"          "32225"          "29021"         </span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  [41] "27226"          "23761"          "23031"          "35988"         </span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  [45] "32639"          "30814"          "31287"          "33113"         </span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  [49] "28474"          "26284"          "35149"          "35863"         </span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  [53] "26843"          "26478"          "35980"          "36710"         </span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  [57] "16753"          "14563"          "31415"          "33605"         </span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  [61] "32037"          "30942"          "18969"          "19670"         </span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  [65] "17763"          "33145"          "30956"          "30811"         </span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  [69] "30081"          "25630"          "18806"          "20266"         </span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  [73] "32151"          "33976"          "16520"          "31902"         </span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  [77] "31598"          "30492"          "30127"          "23592"         </span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="do">##  [81] "31542"          "32637"          "25419"          "26879"         </span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="do">##  [85] "23167"          "21707"          "13065"          "28288"         </span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="do">##  [89] "27193"          "20233"          "22062"          "32375"         </span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="do">##  [93] "32534"          "35077"          "22915"          "23178"         </span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="do">##  [97] "1982.08.30"     "29089"          "19278"          "35450"         </span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="do">## [101] "36545"          "39667"          "27979"          "29697"         </span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="do">## [105] "31668"          "33128"          "33932"          "31742"         </span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="do">## [109] "23227"          "19534"          "17344"          "26978"         </span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="do">## [113] "28438"          "24090"          "21900"          "23393"         </span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="do">## [117] "25822"          "23964"          "22740"          "33431"         </span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="do">## [121] "34473"          "30508"          "30892"          "28378"         </span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="do">## [125] "28626"          "36319"          "1993\\03\\09"   "26278"         </span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="do">## [129] "27435"          "30606"          "29876"          "32136"         </span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="do">## [133] "28948"          "29678"          "28518"          "30708"         </span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="do">## [137] "34770"          "36230"          "29411"          "32282"         </span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="do">## [141] "25421"          "26700"          "22657"          "21562"         </span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="do">## [145] "31551"          "28994"          "21019"          "20572"         </span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="do">## [149] "26042"          "33020"          "21720"          "22815"         </span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="do">## [153] "24514"          "25456"          "1959-13-01"     "28012"         </span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="do">## [157] "26792"          "20473"          "21203"          "17327"         </span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="do">## [161] "19187"          "19826"          "20202"          "36392"         </span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="do">## [165] "29588"          "30599"          "30055"          "24150"         </span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="do">## [169] "23055"          "29145"          "17704"          "33541"         </span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="do">## [173] "32081"          "34283"          "31620"          "30031"         </span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="do">## [177] "28897"          "26707"          "26053"          "31623"         </span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="do">## [181] "30923"          "23930"          "22713"          "25842"         </span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="do">## [185] "26207"          "26010"          "28169"          "35542"         </span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="do">## [189] "34021"          "28427"          "27130"          "33230"         </span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="do">## [193] "29733"          "29978"          "31288"          "36799"         </span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="do">## [197] "16590"          "16950"          "34119"          "34200"         </span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="do">## [201] "21325"          "20230"          "18033"          "19035"         </span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="do">## [205] "29840"          "31069"          "31026"          "30021"         </span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="do">## [209] "30176"          "31985"          "21839"          "20059"         </span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="do">## [213] "35343"          "35759"          "29414"          "22334"         </span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a><span class="do">## [217] "24432"          "22457"          "22057"          "33930"         </span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="do">## [221] "35987"          "23519"          "31424"          "27418"         </span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a><span class="do">## [225] "26973"          "39263"          "30145"          "42605"         </span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="do">## [229] "32205"          "31037"          "39960"          "26085"         </span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a><span class="do">## [233] "27129"          "41364"          "38990"          "31481"         </span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a><span class="do">## [237] "31204"          "26540"          "26297"          "27205"         </span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a><span class="do">## [241] "18378"          "31911"          "32104"          "21965"         </span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a><span class="do">## [245] "22289"          "30946"          "30723"          "41204"         </span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a><span class="do">## [249] "13985"          "28136"          "25946"          "27834"         </span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a><span class="do">## [253] "17879"          "31449"          "30650"          "31843"         </span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a><span class="do">## [257] "30200"          "41869"          "25017"          "26924"         </span></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a><span class="do">## [261] "20042"          "18966"          "31093"          "23116"         </span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a><span class="do">## [265] "30373"          "29722"          "20496"          "20603"         </span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a><span class="do">## [269] "36954"          "29372"          "29007"          "20500"         </span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a><span class="do">## [273] "23631"          "23430"          "23192"          "22097"         </span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a><span class="do">## [277] "35339"          "20936"          "33454"          "35279"         </span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a><span class="do">## [281] "41691"          "31737"          "31372"          "38281"         </span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a><span class="do">## [285] "25848"          "25483"          "34384"          "35479"         </span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a><span class="do">## [289] "35112"          "37302"          "33492"          "42365"         </span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a><span class="do">## [293] "42334"          "18686"          "32016"          "33476"         </span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a><span class="do">## [297] "30167"          "29072"          "23903"          "18472"         </span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a><span class="do">## [301] "19932"          "35442"          "15166"          "32337"         </span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a><span class="do">## [305] "33291"          "31861"          "33686"          "29651"         </span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a><span class="do">## [309] "28556"          "34419"          "24315"          "23950"         </span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a><span class="do">## [313] "32727"          "33092"          "35791"          "33601"         </span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a><span class="do">## [317] "29865"          "31690"          "17091"          "17821"         </span></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a><span class="do">## [321] "30697"          "31427"          "19003"          "17908"         </span></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a><span class="do">## [325] "17943"          "19038"          "23510"          "24605"         </span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a><span class="do">## [329] "23310"          "22366"          "26667"          "27032"         </span></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a><span class="do">## [333] "31337"          "32432"          "30875"          "28561"         </span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a><span class="do">## [337] "32966"          "33396"          "30045"          "33783"         </span></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a><span class="do">## [341] "33053"          "27808"          "25618"          "17459"         </span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a><span class="do">## [345] "26154"          "24693"          "21673"          "23863"         </span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a><span class="do">## [349] "25027"          "25545"          "25249"          "24427"         </span></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a><span class="do">## [353] "32845"          "34670"          "28681"          "21371"         </span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a><span class="do">## [357] "27241"          "27606"          "25260"          "27085"         </span></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a><span class="do">## [361] "29667"          "29419"          "30514"          "35887"         </span></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a><span class="do">## [365] "36617"          "13342"          "32994"          "31070"         </span></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a><span class="do">## [369] "20373"          "17579"          "35827"          "36505"         </span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a><span class="do">## [373] "17012"          "16283"          "29027"          "29454"         </span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a><span class="do">## [377] "27286"          "28016"          "33529"          "32069"         </span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a><span class="do">## [381] "28397"          "29795"          "40128"          "18734"         </span></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a><span class="do">## [385] "19088"          "20303"          "22235"          "23330"         </span></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a><span class="do">## [389] "24299"          "22474"          "19791"          "32112"         </span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a><span class="do">## [393] "33207"          "29246"          "27786"          "28295"         </span></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a><span class="do">## [397] "27565"          "22939"          "23304"          "30427"         </span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a><span class="do">## [401] "28602"          "29613"          "30708"          "22637"         </span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a><span class="do">## [405] "23367"          "31375"          "33049"          "18664"         </span></span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a><span class="do">## [409] "24206"          "21278"          "21643"          "29419"         </span></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a><span class="do">## [413] "27594"          "33970"          "28501"          "23385"         </span></span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a><span class="do">## [417] "37121"          "35661"          "18787"          "18422"         </span></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a><span class="do">## [421] "33249"          "33709"          "34408"          "34010"         </span></span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a><span class="do">## [425] "24177"          "23813"          "41820"          "26822"         </span></span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a><span class="do">## [429] "26457"          "25844"          "24871"          "12529"         </span></span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a><span class="do">## [433] "26216"          "24026"          "26605"          "29946"         </span></span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a><span class="do">## [437] "29216"          "30170"          "28740"          "29257"         </span></span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a><span class="do">## [441] "23401"          "22849"          "22908"          "25098"         </span></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a><span class="do">## [445] "25129"          "27323"          "20054"          "33182"         </span></span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a><span class="do">## [449] "32213"          "27909"          "29734"          "16472"         </span></span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a><span class="do">## [453] "28628"          "29352"          "27162"          "32544"         </span></span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a><span class="do">## [457] "31084"          "27762"          "25934"          "30175"         </span></span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a><span class="do">## [461] "30813"          "26102"          "23912"          "15100"         </span></span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a><span class="do">## [465] "33988"          "33853"          "28710"          "26550"         </span></span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a><span class="do">## [469] "30398"          "32308"          "36487"          "36852"         </span></span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a><span class="do">## [473] "30950"          "30771"          "24272"          "22883"         </span></span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a><span class="do">## [477] "15960"          "28034"          "28415"          "30691"         </span></span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a><span class="do">## [481] "29901"          "18532"          "19922"          "26371"         </span></span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a><span class="do">## [485] "16445"          "14255"          "24067"          "22727"         </span></span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a><span class="do">## [489] "32163"          "30885"          "18894"          "28178"         </span></span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a><span class="do">## [493] "29613"          "30725"          "31780"          "26180"         </span></span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a><span class="do">## [497] "28170"          "33523"          "33602"          "18908"         </span></span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a><span class="do">## [501] "20368"          "29139"          "27314"          "28794"         </span></span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a><span class="do">## [505] "26969"          "31058"          "30725"          "31145"         </span></span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a><span class="do">## [509] "31690"          "30018"          "30508"          "19205"         </span></span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a><span class="do">## [513] "27836"          "29480"          "16204"          "30682"         </span></span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a><span class="do">## [517] "31945"          "26765"          "30241"          "31704"         </span></span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a><span class="do">## [521] "22755"          "24751"          "23322"          "25455"         </span></span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a><span class="do">## [525] "26734"          "26293"          "27722"          "28568"         </span></span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a><span class="do">## [529] "35367"          "34328"          "28938"          "28290"         </span></span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a><span class="do">## [533] "28637"          "29753"          "17688"          "16838"         </span></span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a><span class="do">## [537] "31480"          "22323"          "23273"          "22659"         </span></span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a><span class="do">## [541] "24624"          "38576"          "24743"          "25082"         </span></span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a><span class="do">## [545] "26239"          "24370"          "40007"          "27966"         </span></span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a><span class="do">## [549] "27557"          "27479"          "28471"          "24233"         </span></span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a><span class="do">## [553] "25826"          "29297"          "28047"          "26560"         </span></span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a><span class="do">## [557] "29173"          "28991"          "21039"          "19967"         </span></span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a><span class="do">## [561] "31104"          "32600"          "28545"          "29118"         </span></span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a><span class="do">## [565] "13246"          "31359"          "29862"          "1968-July-18th"</span></span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a><span class="do">## [569] "19127"          "18770"          "22661"          "23178"         </span></span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a><span class="do">## [573] "23552"          "25965"          "26291"          "21520"         </span></span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a><span class="do">## [577] "36070"          "35382"          "26373"          "25991"         </span></span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a><span class="do">## [581] "26374"          "32308"          "30848"          "28901"         </span></span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a><span class="do">## [585] "26943"          "32382"          "32637"          "41131"         </span></span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a><span class="do">## [589] "29576"          "28390"          "40138"          "31410"         </span></span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a><span class="do">## [593] "25090"          "16308"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>If we look through the data, there’s actually only 5 entries with issues:</p>
<ul>
<li><p>Entry 14 - Aug 21, 1992</p></li>
<li><p>Entry 97 - Aug 30, 1982</p></li>
<li><p>Entry 127 - Mar 9, 1993</p></li>
<li><p>Entry 155 - Jan 13, 1959 (let’s assume the order of month and day were mixed)</p></li>
<li><p>Entry 568 - Jul 18, 1968</p></li>
</ul>
<p>These are all easy to fix if we stick with indices that we learned about in R-basics.. but we’ll need to convert these dates into Excel format first, then revert everything into a more sensical format once everything is numeric.</p>
<p>We’ll want to convert the intended date to a class that we can deal with numerically, then extract the number of days between that date and the beginning of 1900-01-01 to get the date as an excel format. Lubridate makes this pretty easy for us with the ymd() function!</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(lubridate)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>birthdates[<span class="dv">14</span>] <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">"1992-08-21"</span>) <span class="sc">-</span> <span class="fu">ymd</span>(<span class="st">"1899-12-30"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>birthdates[<span class="dv">97</span>] <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">"1982-08-30"</span>) <span class="sc">-</span> <span class="fu">ymd</span>(<span class="st">"1899-12-30"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>birthdates[<span class="dv">127</span>] <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">"1993-03-09"</span>) <span class="sc">-</span> <span class="fu">ymd</span>(<span class="st">"1899-12-30"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>birthdates[<span class="dv">155</span>] <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">"1959-01-13"</span>) <span class="sc">-</span> <span class="fu">ymd</span>(<span class="st">"1899-12-30"</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>birthdates[<span class="dv">568</span>] <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">"1968-07-18"</span>) <span class="sc">-</span> <span class="fu">ymd</span>(<span class="st">"1899-12-30"</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(birthdates) <span class="co"># check to make sure everything looks OK</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="do">##   [1] "21445" "27047" "28507" "36314" "35219" "23589" "23224" "35962" "35506"</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  [10] "34776" "26125" "36119" "31647" "33837" "17882" "21782" "21052" "34099"</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  [19] "35194" "23545" "22815" "17244" "36900" "30627" "30262" "18054" "20244"</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  [28] "33628" "33994" "29601" "31791" "33258" "33623" "28136" "17175" "30936"</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  [37] "32396" "31966" "32225" "29021" "27226" "23761" "23031" "35988" "32639"</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  [46] "30814" "31287" "33113" "28474" "26284" "35149" "35863" "26843" "26478"</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  [55] "35980" "36710" "16753" "14563" "31415" "33605" "32037" "30942" "18969"</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  [64] "19670" "17763" "33145" "30956" "30811" "30081" "25630" "18806" "20266"</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  [73] "32151" "33976" "16520" "31902" "31598" "30492" "30127" "23592" "31542"</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  [82] "32637" "25419" "26879" "23167" "21707" "13065" "28288" "27193" "20233"</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  [91] "22062" "32375" "32534" "35077" "22915" "23178" "30193" "29089" "19278"</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="do">## [100] "35450" "36545" "39667" "27979" "29697" "31668" "33128" "33932" "31742"</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="do">## [109] "23227" "19534" "17344" "26978" "28438" "24090" "21900" "23393" "25822"</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="do">## [118] "23964" "22740" "33431" "34473" "30508" "30892" "28378" "28626" "36319"</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="do">## [127] "34037" "26278" "27435" "30606" "29876" "32136" "28948" "29678" "28518"</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="do">## [136] "30708" "34770" "36230" "29411" "32282" "25421" "26700" "22657" "21562"</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="do">## [145] "31551" "28994" "21019" "20572" "26042" "33020" "21720" "22815" "24514"</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="do">## [154] "25456" "21563" "28012" "26792" "20473" "21203" "17327" "19187" "19826"</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="do">## [163] "20202" "36392" "29588" "30599" "30055" "24150" "23055" "29145" "17704"</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="do">## [172] "33541" "32081" "34283" "31620" "30031" "28897" "26707" "26053" "31623"</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="do">## [181] "30923" "23930" "22713" "25842" "26207" "26010" "28169" "35542" "34021"</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="do">## [190] "28427" "27130" "33230" "29733" "29978" "31288" "36799" "16590" "16950"</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="do">## [199] "34119" "34200" "21325" "20230" "18033" "19035" "29840" "31069" "31026"</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="do">## [208] "30021" "30176" "31985" "21839" "20059" "35343" "35759" "29414" "22334"</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="do">## [217] "24432" "22457" "22057" "33930" "35987" "23519" "31424" "27418" "26973"</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="do">## [226] "39263" "30145" "42605" "32205" "31037" "39960" "26085" "27129" "41364"</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="do">## [235] "38990" "31481" "31204" "26540" "26297" "27205" "18378" "31911" "32104"</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="do">## [244] "21965" "22289" "30946" "30723" "41204" "13985" "28136" "25946" "27834"</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="do">## [253] "17879" "31449" "30650" "31843" "30200" "41869" "25017" "26924" "20042"</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="do">## [262] "18966" "31093" "23116" "30373" "29722" "20496" "20603" "36954" "29372"</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="do">## [271] "29007" "20500" "23631" "23430" "23192" "22097" "35339" "20936" "33454"</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="do">## [280] "35279" "41691" "31737" "31372" "38281" "25848" "25483" "34384" "35479"</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="do">## [289] "35112" "37302" "33492" "42365" "42334" "18686" "32016" "33476" "30167"</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="do">## [298] "29072" "23903" "18472" "19932" "35442" "15166" "32337" "33291" "31861"</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="do">## [307] "33686" "29651" "28556" "34419" "24315" "23950" "32727" "33092" "35791"</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="do">## [316] "33601" "29865" "31690" "17091" "17821" "30697" "31427" "19003" "17908"</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="do">## [325] "17943" "19038" "23510" "24605" "23310" "22366" "26667" "27032" "31337"</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="do">## [334] "32432" "30875" "28561" "32966" "33396" "30045" "33783" "33053" "27808"</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="do">## [343] "25618" "17459" "26154" "24693" "21673" "23863" "25027" "25545" "25249"</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="do">## [352] "24427" "32845" "34670" "28681" "21371" "27241" "27606" "25260" "27085"</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="do">## [361] "29667" "29419" "30514" "35887" "36617" "13342" "32994" "31070" "20373"</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="do">## [370] "17579" "35827" "36505" "17012" "16283" "29027" "29454" "27286" "28016"</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="do">## [379] "33529" "32069" "28397" "29795" "40128" "18734" "19088" "20303" "22235"</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="do">## [388] "23330" "24299" "22474" "19791" "32112" "33207" "29246" "27786" "28295"</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a><span class="do">## [397] "27565" "22939" "23304" "30427" "28602" "29613" "30708" "22637" "23367"</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a><span class="do">## [406] "31375" "33049" "18664" "24206" "21278" "21643" "29419" "27594" "33970"</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a><span class="do">## [415] "28501" "23385" "37121" "35661" "18787" "18422" "33249" "33709" "34408"</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="do">## [424] "34010" "24177" "23813" "41820" "26822" "26457" "25844" "24871" "12529"</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a><span class="do">## [433] "26216" "24026" "26605" "29946" "29216" "30170" "28740" "29257" "23401"</span></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a><span class="do">## [442] "22849" "22908" "25098" "25129" "27323" "20054" "33182" "32213" "27909"</span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a><span class="do">## [451] "29734" "16472" "28628" "29352" "27162" "32544" "31084" "27762" "25934"</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="do">## [460] "30175" "30813" "26102" "23912" "15100" "33988" "33853" "28710" "26550"</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a><span class="do">## [469] "30398" "32308" "36487" "36852" "30950" "30771" "24272" "22883" "15960"</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="do">## [478] "28034" "28415" "30691" "29901" "18532" "19922" "26371" "16445" "14255"</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a><span class="do">## [487] "24067" "22727" "32163" "30885" "18894" "28178" "29613" "30725" "31780"</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a><span class="do">## [496] "26180" "28170" "33523" "33602" "18908" "20368" "29139" "27314" "28794"</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a><span class="do">## [505] "26969" "31058" "30725" "31145" "31690" "30018" "30508" "19205" "27836"</span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a><span class="do">## [514] "29480" "16204" "30682" "31945" "26765" "30241" "31704" "22755" "24751"</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a><span class="do">## [523] "23322" "25455" "26734" "26293" "27722" "28568" "35367" "34328" "28938"</span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a><span class="do">## [532] "28290" "28637" "29753" "17688" "16838" "31480" "22323" "23273" "22659"</span></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a><span class="do">## [541] "24624" "38576" "24743" "25082" "26239" "24370" "40007" "27966" "27557"</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a><span class="do">## [550] "27479" "28471" "24233" "25826" "29297" "28047" "26560" "29173" "28991"</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a><span class="do">## [559] "21039" "19967" "31104" "32600" "28545" "29118" "13246" "31359" "29862"</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a><span class="do">## [568] "25037" "19127" "18770" "22661" "23178" "23552" "25965" "26291" "21520"</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a><span class="do">## [577] "36070" "35382" "26373" "25991" "26374" "32308" "30848" "28901" "26943"</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a><span class="do">## [586] "32382" "32637" "41131" "29576" "28390" "40138" "31410" "25090" "16308"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now that we’ve created a new variable with the correct Excel formats, let’s convert it into the correct date format, and save the whole variable back to the manifest.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Use as_date() from lubridate, and set the Excel origin</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We'll need to change our birthdates back to numeric first, as well. </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>birthdates <span class="ot">&lt;-</span> <span class="fu">as_date</span>(<span class="fu">as.numeric</span>(birthdates), <span class="at">origin=</span> <span class="st">"1899-12-30"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>manifest<span class="sc">$</span>pass.dob <span class="ot">&lt;-</span> birthdates</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Doublecheck to make sure that the DOB column now looks good: </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(manifest)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 594</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Columns: 16</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="do">## $ pass.fname                 &lt;chr&gt; "Nicole", "Nicole", "Scott", "Julie", "Kait…</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="do">## $ pass.lname                 &lt;chr&gt; "Miller", "Ramirez", "Ramirez", "Spencer", …</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="do">## $ pass.dob                   &lt;date&gt; 1958-09-17, 1974-01-18, 1978-01-17, 1999-0…</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="do">## $ pass.age                   &lt;dbl&gt; 67, 51, 47, 26, 29, 61, 62, 27, 28, 30, 54,…</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="do">## $ pass.gender                &lt;chr&gt; "Female", "Female", "Male", "Female", "Fema…</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="do">## $ pass.status                &lt;chr&gt; "Silver", "Platinum", "Platinum", "Silver",…</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="do">## $ home.address               &lt;chr&gt; "8125 Tony Stravenue Boulevard, Lethbridge,…</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="do">## $ home.city                  &lt;chr&gt; "Lethbridge", "Red Deer", "Red Deer", "Red …</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="do">## $ home.prov                  &lt;chr&gt; "AB", "AB", "AB", "AB", "AB", "British Colu…</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="do">## $ home.country               &lt;chr&gt; "Canada", "Canada", "Canada", "Canada", "Ca…</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="do">## $ emerg.contact.fname        &lt;chr&gt; "Lisa", "Jeffrey", "Jeffrey", "Bradley", "B…</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="do">## $ emerg.contact.lname        &lt;chr&gt; "Jackson", "Meyer", "Meyer", "Robertson", "…</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="do">## $ emerg.contact.relationship &lt;chr&gt; "Relative", "Relative", "Relative", "Other"…</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="do">## $ emerg.contact.phone        &lt;chr&gt; "(483) 503-0564", "(356) 159-5148", "(356) …</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="do">## $ board.date                 &lt;chr&gt; "Feb 9th", "Feb 9th", "Feb 9th", "Feb 9th",…</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="do">## $ board.location             &lt;chr&gt; "Halifax, NS", "Halifax, NS", "Halifax, NS"…</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now you can see that the pass.dob variable contains all dates in an actual date format. Hurrah!</p>
</section>
<section id="step-3-re-create-an-age-variable-from-dob" class="level3">
<h3 class="anchored" data-anchor-id="step-3-re-create-an-age-variable-from-dob">Step 3: (Re-)Create an age variable from DOB</h3>
<p>After the shenanigans involved in the last step, this should be an absolute sea-breeze. Let’s recreate the age variable in our dataset, using the passenger date of birth, and the date that the cruise set sail as the day to calculate age.</p>
<p>The way that we treat age can be a little tricky, so it’s best to break it down into smaller steps, working backwards like so:</p>
<ol type="1">
<li>Calculate the time interval passed between the date of birth and the departure date of the <em>S.S. Rainbow Cake</em></li>
</ol>
<blockquote class="blockquote">
<p>interval(pass.dob, ymd(“2025-02-10”))</p>
</blockquote>
<ol start="2" type="1">
<li>Get the exact length of that interval, and return the value in years</li>
</ol>
<blockquote class="blockquote">
<p>time_length(interval, “years”)</p>
</blockquote>
<ol start="3" type="1">
<li>Round that value down to an integer</li>
</ol>
<blockquote class="blockquote">
<p>floor(time_length)</p>
</blockquote>
<ol start="4" type="1">
<li>Save this as a new variable in your manifest data frame</li>
</ol>
<blockquote class="blockquote">
<p>mutate(pass.age = …)</p>
</blockquote>
<p>Try coding these all into one statement on your own, then check against our code below!</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>manifest <span class="ot">&lt;-</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  manifest <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pass.age =</span> <span class="fu">floor</span>(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">time_length</span>(</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">interval</span>(pass.dob, <span class="fu">ymd</span>(<span class="st">"2025-02-10"</span>)),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"years"</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Did you know
</div>
</div>
<div class="callout-body-container callout-body">
<p>Historic passenger manifests from naval crossings in the late 19th and early 20th centuries are available at the <a href="https://www.bac-lac.gc.ca/eng/discover/immigration/immigration-records/passenger-lists/passenger-lists-1865-1922/Pages/introduction.aspx" title="Passenger lists 1865-1922">Library and Archives Canada website</a>? You can search the passenger database using dates, ports of departure and arrival, and ship names!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pics/LAC_shipmanifest_handwritten.jpg" class="img-fluid figure-img" alt="A photograph of a ships manifest from the late 19th century"></p>
<figcaption>Library and archives Canada image of an historic passenger manifest</figcaption>
</figure>
</div>
<p>Here’s an example of a meticulously-collected and beautifully hand-written data set - imagine having to clean and digitize all these records!</p>
</div>
</div>
</section>
<section id="step-4-fix-province-variable" class="level3">
<h3 class="anchored" data-anchor-id="step-4-fix-province-variable">Step 4: Fix Province variable</h3>
<p>We noted already that the Province variable (e.g., <strong>home.prov</strong>) appears to have been entered inconsistently! Some entries have the full name of the province spelled out, some abbreviated, some abbreviated multiple ways.. needless to say, this needs to be fixed and put into a consistent format, so let’s practice that now.</p>
<p>The first thing we’ll want to do is check the variable and extract a list of all the different ways that provinces have been coded. If we were to do this with all the observations in our dataset, though, we’d end up with a very long list that included a lot of redundant entries. Instead - let’s create a non-redundant list first, using another handy tidyverse function: <strong>distinct()</strong>.</p>
<p>To do this, we’ll invoke our manifest dataframe, select the “home.prov” variable, then call the distinct() function. E.g.,</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>manifest <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"home.prov"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 19 × 1</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    home.prov                </span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                    </span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 AB                       </span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 British Columbia         </span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Quebec                   </span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 BC                       </span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Ontario                  </span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 QC                       </span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Manitoba                 </span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 ON                       </span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Québec                   </span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Nova Scotia              </span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 NS                       </span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 Alberta                  </span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 13 Prince Edward Island     </span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 14 Saskatchewan             </span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 15 SK                       </span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 16 New Brunswick            </span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 17 Sask                     </span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 18 NFLD                     </span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 19 Newfoundland and Labrador</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Based on the above output, we have 19 different versions of province names included, but we definitely do not have 19 different provinces in Canada! You’ll notice as well that Quebec sometimes has an accent, and sometimes does not. Let’s propose to simplify things, and in our final dataset, just use 2-letter abbreviations for provinces.</p>
<p>This does mean that we’ll need to identify all the variations present for each province, then replace them with the abbreviated version. To make sure that we can review and verify, we’ll create a new variable with these replacements first, then overwrite our old variable once we’ve checked and verified that things are done correctly.</p>
<section id="the-case_when-function" class="level4">
<h4 class="anchored" data-anchor-id="the-case_when-function">The case_when function</h4>
<p>Our current operation is a great time to practice the case_when() function. This function will end up coming in very handy over and over again, so its a good chance for us to get well-acquainted with it now.</p>
<p>The function case_when looks for observations or rows in your dataset that evaluate some condition being true, then returns a value when this is found. If you have ever played with “if…then” statements or used the <strong>ifelse()</strong> function in R - then this will feel very familiar to you. In our scenario - we have observations that may appear to satisfy one of a number of cases, and when this occurs, we want to return another value. We just have to type them out using the following syntax:</p>
<blockquote class="blockquote">
<p>case_when(conditional statement 1 ~ value to return if true,</p>
<p>conditional statement 2 ~ value to return if true,</p>
<p>conditional statement 3 ~ value to return if true,</p>
<p>…(continue with as many statements as you need)</p>
<p>TRUE ~ value to return if above conditions are FALSE)</p>
</blockquote>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>manifest <span class="ot">&lt;-</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>manifest <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">home.prov.abb =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'BC'</span> <span class="sc">~</span> <span class="st">'BC'</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'British Columbia'</span> <span class="sc">~</span> <span class="st">'BC'</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'AB'</span> <span class="sc">~</span> <span class="st">'AB'</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'Alberta'</span> <span class="sc">~</span> <span class="st">'AB'</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'SK'</span> <span class="sc">~</span> <span class="st">'SK'</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'Sask'</span> <span class="sc">~</span> <span class="st">'SK'</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'Saskatchewan'</span> <span class="sc">~</span> <span class="st">'SK'</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'MB'</span> <span class="sc">~</span> <span class="st">'MB'</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'Manitoba'</span> <span class="sc">~</span> <span class="st">'MB'</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'ON'</span> <span class="sc">~</span> <span class="st">'ON'</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'Ontario'</span> <span class="sc">~</span> <span class="st">'ON'</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'QC'</span> <span class="sc">~</span> <span class="st">'QC'</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'Quebec'</span> <span class="sc">~</span> <span class="st">'QC'</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'Québec'</span> <span class="sc">~</span> <span class="st">'QC'</span>,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'NS'</span> <span class="sc">~</span> <span class="st">'NS'</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'Nova Scotia'</span> <span class="sc">~</span> <span class="st">'NS'</span>,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'PEI'</span> <span class="sc">~</span> <span class="st">'PEI'</span>,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'Prince Edward Island'</span> <span class="sc">~</span> <span class="st">'PEI'</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'New Brunswick'</span> <span class="sc">~</span> <span class="st">'NB'</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'NFLD'</span> <span class="sc">~</span> <span class="st">'NL'</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    home.prov <span class="sc">==</span> <span class="st">'Newfoundland and Labrador'</span> <span class="sc">~</span> <span class="st">'NL'</span>,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"missing"</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    ))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now, to check whether or not we missed any provinces in the list, let’s filter our new variable, looking for instances of the ‘missing’ entry that we specified as our catch-all.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>manifest <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(home.prov.abb <span class="sc">==</span> <span class="st">'missing'</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 0 × 17</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ 17 variables: pass.fname &lt;chr&gt;, pass.lname &lt;chr&gt;, pass.dob &lt;date&gt;,</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="do">## #   pass.age &lt;dbl&gt;, pass.gender &lt;chr&gt;, pass.status &lt;chr&gt;, home.address &lt;chr&gt;,</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="do">## #   home.city &lt;chr&gt;, home.prov &lt;chr&gt;, home.country &lt;chr&gt;,</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="do">## #   emerg.contact.fname &lt;chr&gt;, emerg.contact.lname &lt;chr&gt;,</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="do">## #   emerg.contact.relationship &lt;chr&gt;, emerg.contact.phone &lt;chr&gt;,</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="do">## #   board.date &lt;chr&gt;, board.location &lt;chr&gt;, home.prov.abb &lt;chr&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Since our filter returned zero rows of the home.prov.abb variable that were ‘missing’ (and nothing returned NA), we can rest knowing that our variable is complete. Now we’ll replace the home.prov variable with the one that we created, and remove the temporary variable from the dataset.</p>
<p>Note: in this example, we’ll use the select() function with a negative operator to specify which variables to drop.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>manifest <span class="ot">&lt;-</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  manifest <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">home.prov =</span> home.prov.abb) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>home.prov.abb)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="step-5-emergency-contact-information" class="level3">
<h3 class="anchored" data-anchor-id="step-5-emergency-contact-information">Step 5: Emergency Contact Information</h3>
<p>Looking through the emergency contact information, we can see that there are several issues with the character strings taking place.</p>
<ol type="1">
<li>There are several missing and marked as NA (not much we can do about these at the moment).</li>
<li>When a name includes a professional designation (like “D.D.S.”) then this gets added to the person’s last name. We’ll ignore the strangeness of people using their dentist as their emergency contact, and focus on fixing these for the sake of clean data entry only.</li>
<li>When a name is prefixed with a title (e.g., “Dr.”) the prefix becomes the contact’s first name, and has pushed first and last name into the same variable.</li>
</ol>
<section id="the-stringr-package" class="level4">
<h4 class="anchored" data-anchor-id="the-stringr-package">The stringr package</h4>
<p>Issues within variables that contain character-strings are a perfect opportunity to practice with functions from the <strong>stringr</strong> package. No need to load anything new - <strong>stringr</strong> contains some very useful data-cleaning tools for character data, including the function <a href="https://stringr.tidyverse.org/reference/str_replace.html" title="Replace character matches with new text">str_replace()</a> which will allow us to modify character strings using a <em>pattern</em> and <em>replacement</em> strategy.</p>
<p>Since we want to affect all the entries in the variable, we’ll use the version of the function str_replace_all() which can modify all entries at once, rather than seeking just the first entry that meets our criteria. The inputs for str_replace_all() are as follows:</p>
<blockquote class="blockquote">
<pre><code>str_replace_all(string, pattern, replacement)</code></pre>
</blockquote>
<ul>
<li><p><em>string</em> = the variable containing character strings you wish to modify</p></li>
<li><p><em>pattern</em> = the pattern you want to replace</p></li>
<li><p><em>replacement</em> = the character string to be used as the replacement</p></li>
</ul>
<p>Let’s use the function now to modify the emergency contact first and last name fields. We need to remove the titles “Mr.”, “Mrs.”, and “Dr.”, so we’ll just replace them with an empty string: ““. We’ll do the same thing to the suffixes in the last-name field, replacing DDS and Jr.&nbsp;with”“.</p>
<p>You’ll notice in the code below that we use a double-escape (\\) before a period. This is because stringr functions use <strong>regex</strong> (regular expressions) conventions as wildcards, and the period (.) is a wildcard for <em>anything</em>. So if we didn’t escape the character ‘.’ in ‘Dr.’ for example, then R will look for the string ‘Dr’ followed by any string of any length, and we don’t want that.</p>
<p><a href="https://regexlearn.com/cheatsheet" title="Regular expressions cheatsheet">Regex</a> is a deep and powerful toolset that we encourage you to check out, should you be interested in it, however, we will not be covering it any further in this course.</p>
<p>Let’s try writing out the code for prefixes and suffixes. We’ll call our manifest dataframe, use mutate() to let R know we’re affecting change on a variable, in this case emerg.contact.fname and emerg.contact.lastname, then specify our string replacements using str_replace_all().</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>manifest <span class="ot">&lt;-</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>manifest <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">emerg.contact.fname =</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_replace_all</span>(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">string =</span> emerg.contact.fname,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">pattern =</span> <span class="st">"(Mr</span><span class="sc">\\</span><span class="st">.|Mrs</span><span class="sc">\\</span><span class="st">.|Dr</span><span class="sc">\\</span><span class="st">.)"</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">replacement =</span> <span class="st">""</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">emerg.contact.lname =</span> </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_replace_all</span>(</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">string =</span> emerg.contact.lname,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">pattern =</span> <span class="st">"(DDS|Jr</span><span class="sc">\\</span><span class="st">.)"</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">replacement =</span> <span class="st">""</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Great work! We’re almost done with this step, all that is left to do now, is to fix the squished names present in the emerg.contact.lname variable. Let’s discuss two approaches.</p>
<ol type="1">
<li>We <em>could</em> spend some time figuring out a regular expression to separate text based on letter case. In this instance, we would be looking for the position in the string that changes from lower case to upper case. E.g., DavidSmith –&gt; David | Smith. However, remember that we’re applying this function to the entire variable, and if our syntax isn’t 100% correct, we could inadvertently introduce more errors into the mix.</li>
<li>Instead, we recommend fixing the entries explicitly, using the exact examples that need fixing. This may seem slightly more tedious, but in this example, it is far safer, and will save us from a lot of headache if our code in option 1 doesn’t function the way we expect it to.</li>
</ol>
<p>With this in mind, lets specify the first-names we want to replace in the emerg.contact.fname variable based on the emerg.contact.lname variable, then fix the last names once that’s done.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>manifest <span class="ot">&lt;-</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>manifest <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">emerg.contact.fname =</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">case_when</span>(emerg.contact.lname <span class="sc">==</span> <span class="st">"DavidSmith"</span> <span class="sc">~</span> <span class="st">"David"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                     emerg.contact.lname <span class="sc">==</span> <span class="st">"GeorgeBooker"</span> <span class="sc">~</span> <span class="st">"George"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                     emerg.contact.lname <span class="sc">==</span> <span class="st">"DouglasEvans"</span> <span class="sc">~</span> <span class="st">"Douglas"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                     emerg.contact.lname <span class="sc">==</span> <span class="st">"JacobScott"</span> <span class="sc">~</span> <span class="st">"Jacob"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                     emerg.contact.lname <span class="sc">==</span> <span class="st">"ToniAvila"</span> <span class="sc">~</span> <span class="st">"Toni"</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                     <span class="cn">TRUE</span> <span class="sc">~</span> emerg.contact.fname</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                     ),</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">emerg.contact.lname =</span> </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">case_when</span>(emerg.contact.lname <span class="sc">==</span> <span class="st">"DavidSmith"</span> <span class="sc">~</span> <span class="st">"Smith"</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                     emerg.contact.lname <span class="sc">==</span> <span class="st">"GeorgeBooker"</span> <span class="sc">~</span> <span class="st">"Booker"</span>,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                     emerg.contact.lname <span class="sc">==</span> <span class="st">"DouglasEvans"</span> <span class="sc">~</span> <span class="st">"Evans"</span>,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>                     emerg.contact.lname <span class="sc">==</span> <span class="st">"JacobScott"</span> <span class="sc">~</span> <span class="st">"Scott"</span>,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>                     emerg.contact.lname <span class="sc">==</span> <span class="st">"ToniAvila"</span> <span class="sc">~</span> <span class="st">"Avila"</span>,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>                     <span class="cn">TRUE</span> <span class="sc">~</span> emerg.contact.lname))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="step-6-fix-boarding-date." class="level3">
<h3 class="anchored" data-anchor-id="step-6-fix-boarding-date.">Step 6: Fix boarding date.</h3>
<p>The last thing to do to get our dataset into tip-top shape is to fix the <strong>boarding date</strong> variable. Since there’s only two variations in this one (e.g., Feb 9th and Feb 10th) this should be an easy fix using our case_when() function. Keep in mind, however, that we may want to be able to use this variable in calculations later, so we should also restore it to a date format using Lubridate’s <strong>ymd()</strong> function.</p>
<p>Let’s wrap these together into one operation:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>manifest <span class="ot">&lt;-</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>manifest <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">board.date =</span> <span class="fu">case_when</span>(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    board.date <span class="sc">==</span> <span class="st">"Feb 9th"</span> <span class="sc">~</span> <span class="fu">ymd</span>(<span class="st">'2025-02-09'</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    board.date <span class="sc">==</span> <span class="st">"Feb 10th"</span> <span class="sc">~</span> <span class="fu">ymd</span>(<span class="st">'2025-02-10'</span>),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="saving-your-dataset-to-disk" class="level3">
<h3 class="anchored" data-anchor-id="saving-your-dataset-to-disk">Saving your dataset to disk</h3>
<p>Have a look through your dataset with the <strong>view()</strong> function, and make sure that everything looks correct. When you’re ready to save the final dataset to a file on your computer, use the <strong>write_csv()</strong> function like so:</p>
<blockquote class="blockquote">
<p>write_csv(dataset, “name_to_save_as.csv”)</p>
</blockquote>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>Congratulations! At this point, you have successfully cleaned up the ship’s manifest, enabling further analysis, and recording a number of really important transformations.</p>
<p>You managed to do all of the following, using only tidyverse functions:</p>
<ol type="1">
<li>Read a complex excel file and store it as a data frame object</li>
<li>Remove egregious excel-formatting from the header of the file</li>
<li>Fix variable names</li>
<li>Fix individual data entries within variables</li>
<li>Fix dates</li>
<li>Fix complex strings</li>
<li>Write a file to disk.</li>
</ol>
<p>That’s a lot! We even managed to sneak a small preview of regular expressions in there!</p>
</section>
<section id="quiz" class="level2">
<h2 class="anchored" data-anchor-id="quiz">Quiz</h2>
<p>Let’s do a quick review of the <strong>Tidyverse functions</strong> we used in this module:</p>
<style>
/* Strong reset for quiz elements so theme CSS doesn't interfere */
.quiz, .quiz * { box-sizing: border-box; }

/* Layout for each choice: radio + text */
.quiz .choice {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  margin-bottom: 6px;
  line-height: 1.25;
}

/* Ensure the input does not collapse or overlap text */
.quiz .choice input[type="radio"] {
  flex: 0 0 auto;
  min-width: 1.05rem;
  min-height: 1.05rem;
  width: 1.05rem;
  height: 1.05rem;
  transform: scale(1.05);
  margin: 0;            /* remove theme margins that can misalign */
  vertical-align: middle;
}

/* Text next to radio - wraps correctly */
.quiz .choice span {
  flex: 1 1 auto;
  display: block;
  word-break: break-word;
  margin-left: 0;       /* guard against theme padding on labels */
}

/* Buttons / spacing */
.quiz button {
  margin-top: 6px;
  margin-bottom: 12px;
}

/* Feedback styling */
.quiz .feedback {
  margin-top: 6px;
  font-weight: 600;
}
</style>
<div class="quiz">
<!-- Q1 -->
<p>
<strong>1. What does <code>mutate()</code> do?</strong>
</p>
<p><label class="choice"><input type="radio" name="q1" value="A">Removes rows from a data frame</label> <label class="choice"><input type="radio" name="q1" value="B">Creates or modifies columns</label> <label class="choice"><input type="radio" name="q1" value="C">Joins two datasets</label> <button onclick="check('q1','B')">Submit</button></p>
<p id="q1-feedback" class="feedback">
</p>
<hr>
<!-- Q2 -->
<p>
<strong>2. In <code>case_when()</code>, what does the final <code>TRUE ~ x</code> line usually mean?</strong>
</p>
<p><label class="choice"><input type="radio" name="q2" value="A">Convert TRUE values to missing</label> <label class="choice"><input type="radio" name="q2" value="B">Leave unmatched values unchanged</label> <label class="choice"><input type="radio" name="q2" value="C">Drop all rows that evaluate to TRUE</label> <button onclick="check('q2','B')">Submit</button></p>
<p id="q2-feedback" class="feedback">
</p>
<hr>
<!-- Q3 -->
<p>
<strong>3. What does <code>ymd()</code> from lubridate do?</strong>
</p>
<p><label class="choice"><input type="radio" name="q3" value="A">Converts strings into Date objects using year–month–day order</label> <label class="choice"><input type="radio" name="q3" value="B">Extracts the year from a date</label> <label class="choice"><input type="radio" name="q3" value="C">Randomly shuffles date values</label> <button onclick="check('q3','A')">Submit</button></p>
<p id="q3-feedback" class="feedback">
</p>
<hr>
<!-- Q4 -->
<p>
<strong>4. What is a common use of <code>str_replace_all()</code>?</strong>
</p>
<p><label class="choice"><input type="radio" name="q4" value="A">Replace all occurrences of patterns in a string</label> <label class="choice"><input type="radio" name="q4" value="B">Split a string into tokens</label> <label class="choice"><input type="radio" name="q4" value="C">Convert character vectors to factors</label> <button onclick="check('q4','A')">Submit</button></p>
<p id="q4-feedback" class="feedback">
</p>
<hr>
<!-- Q5 -->
<p>
<strong>5. What does <code>select()</code> do?</strong>
</p>
<p><label class="choice"><input type="radio" name="q5" value="A">Filter rows based on a logical condition</label> <label class="choice"><input type="radio" name="q5" value="B">Choose columns to keep, drop, or rename</label> <label class="choice"><input type="radio" name="q5" value="C">Convert a data frame into long format</label> <button onclick="check('q5','B')">Submit</button></p>
<p id="q5-feedback" class="feedback">
</p>
<hr>
<!-- Q6 -->
<p>
<strong>6. What does <code>distinct()</code> return?</strong>
</p>
<p><label class="choice"><input type="radio" name="q6" value="A">All duplicated rows</label> <label class="choice"><input type="radio" name="q6" value="B">A data frame with unique rows (or unique combinations of selected columns)</label> <label class="choice"><input type="radio" name="q6" value="C">A list of duplicated column names</label> <button onclick="check('q6','B')">Submit</button></p>
<p id="q6-feedback" class="feedback">
</p>
<hr>
<!-- Q7 -->
<p>
<strong>7. What does a lubridate <code>interval()</code> represent?</strong>
</p>
<p><label class="choice"><input type="radio" name="q7" value="A">A sequence of equally spaced dates</label> <label class="choice"><input type="radio" name="q7" value="B">A duration of time measured in seconds</label> <label class="choice"><input type="radio" name="q7" value="C">A precise time span with a fixed start and end datetime</label> <button onclick="check('q7','C')">Submit</button></p>
<p id="q7-feedback" class="feedback">
</p>
<hr>
<!-- Q8 -->
<p>
<strong>8. What does <code>glimpse()</code> do?</strong>
</p>
<p><label class="choice"><input type="radio" name="q8" value="A">Prints the structure of a data frame in a horizontal, tidy format</label> <label class="choice"><input type="radio" name="q8" value="B">Creates a histogram of numeric variables</label> <label class="choice"><input type="radio" name="q8" value="C">Converts a data frame into a tibble</label> <button onclick="check('q8','A')">Submit</button></p>
<p id="q8-feedback" class="feedback">
</p>
</div>
<script>
function check(questionName, correctValue) {
  const answer = document.querySelector(`input[name="${questionName}"]:checked`)?.value;
  const feedback = document.getElementById(`${questionName}-feedback`);

  if (!answer) {
    feedback.textContent = "Please select an option.";
    feedback.style.color = "orange";
    return;
  }

  if (answer === correctValue) {
    feedback.textContent = "Correct! ✔️";
    feedback.style.color = "green";
  } else {
    feedback.textContent = "Incorrect. Try again.";
    feedback.style.color = "red";
  }
}
</script>


</section></main></div>


 <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/hc-sc\.github\.io\/tdu-rph\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
 <!-- /content -->




</body></html>